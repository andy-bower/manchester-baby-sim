from unittest import TestCase

from src.core.bitarray import b
from src.machines.ssem import Ssem


class TestSTO1(TestCase):

    def setUp(self):
        pass

    def test_STO1(self):
        ssem = Ssem()

        initial_store_lines = [
            b("00000000000000000000000000000000"),
            b("11111000000000100000000000000000"),
            b("01000000000001100000000000000000"),
            b("11000000000001100000000000000000"),
            b("00100000000001100000000000000000"),
            b("10100000000001100000000000000000"),
            b("01100000000001100000000000000000"),
            b("11100000000001100000000000000000"),
            b("00010000000001100000000000000000"),
            b("10010000000001100000000000000000"),
            b("01010000000001100000000000000000"),
            b("11010000000001100000000000000000"),
            b("00110000000001100000000000000000"),
            b("10110000000001100000000000000000"),
            b("01110000000001100000000000000000"),
            b("11110000000001100000000000000000"),
            b("00001000000001100000000000000000"),
            b("10001000000001100000000000000000"),
            b("01001000000001100000000000000000"),
            b("11001000000001100000000000000000"),
            b("00101000000001100000000000000000"),
            b("10101000000001100000000000000000"),
            b("01101000000001100000000000000000"),
            b("11101000000001100000000000000000"),
            b("00011000000001100000000000000000"),
            b("10011000000001100000000000000000"),
            b("01011000000001100000000000000000"),
            b("11011000000001100000000000000000"),
            b("00111000000001100000000000000000"),
            b("10111000000001100000000000000000"),
            b("00000000000001110000000000000000"),
            b("11010101010101010101010101010101"),
        ]
        for i, line in enumerate(initial_store_lines):
            ssem.store[i] = line

        for _ in range(29):
            ssem.stop_flag = False
            ssem.instruction_cycle()

            if ssem.stop_flag:
                break

        expected_store_lines = [
            b("00000000000000000000000000000000"),
            b("11111000000000100000000000000000"),
            b("10101010101010101010101010101010"),
            b("10101010101010101010101010101010"),
            b("10101010101010101010101010101010"),
            b("10101010101010101010101010101010"),
            b("10101010101010101010101010101010"),
            b("10101010101010101010101010101010"),
            b("10101010101010101010101010101010"),
            b("10101010101010101010101010101010"),
            b("10101010101010101010101010101010"),
            b("10101010101010101010101010101010"),
            b("10101010101010101010101010101010"),
            b("10101010101010101010101010101010"),
            b("10101010101010101010101010101010"),
            b("10101010101010101010101010101010"),
            b("10101010101010101010101010101010"),
            b("10101010101010101010101010101010"),
            b("10101010101010101010101010101010"),
            b("10101010101010101010101010101010"),
            b("10101010101010101010101010101010"),
            b("10101010101010101010101010101010"),
            b("10101010101010101010101010101010"),
            b("10101010101010101010101010101010"),
            b("10101010101010101010101010101010"),
            b("10101010101010101010101010101010"),
            b("10101010101010101010101010101010"),
            b("10101010101010101010101010101010"),
            b("10101010101010101010101010101010"),
            b("10101010101010101010101010101010"),
            b("00000000000001110000000000000000"),
            b("11010101010101010101010101010101"),
        ]

        for i, line in enumerate(expected_store_lines):
            self.assertEqual(ssem.store[i], line, f"Line {i}")
